model ActivityLog {
  id          Int      @id @default(autoincrement())
  user_id     String // Foreign Key menjadi String
  action      String   @db.VarChar
  description String?  @db.Text
  created_at  DateTime @default(now()) @db.Timestamp
  user        User     @relation(fields: [user_id], references: [id])
}

model Attachment {
  id             String      @id @default(uuid()) // Diubah ke UUID
  transaction_id String // Foreign Key menjadi String (Transaction UUID)
  file_path      String      @db.VarChar
  file_type      String      @db.VarChar
  created_at     DateTime    @default(now()) @db.Timestamp
  transaction    Transaction @relation(fields: [transaction_id], references: [id], onDelete: Cascade)
}

model Budget {
  id            String   @id @default(uuid()) // Diubah ke UUID
  user_id       String // Foreign Key menjadi String
  monthly_limit Decimal  @db.Decimal
  month_year    DateTime @db.Date
  user          User     @relation(fields: [user_id], references: [id])
}

model Category {
  id           Int             @id @default(autoincrement())
  name         String          @db.VarChar
  icon         String?         @db.VarChar
  type         TransactionType
  transactions Transaction[]
}

model Notification {
  id         Int      @id @default(autoincrement())
  user_id    String // Foreign Key menjadi String
  title      String   @db.VarChar
  content    String   @db.Text
  is_read    Boolean  @default(false)
  created_at DateTime @default(now()) @db.Timestamp
  user       User     @relation(fields: [user_id], references: [id])
}

model Otp {
  id         Int      @id @default(autoincrement())
  user_id    String
  code       String   @db.VarChar(6)
  type       OtpType
  expired_at DateTime @db.Timestamp

  // Relasi
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model PasswordReset {
  email      String   @id @db.VarChar
  token      String   @db.VarChar
  created_at DateTime @default(now()) @db.Timestamp
}

model RefreshToken {
  id         Int      @id @default(autoincrement())
  user_id    String
  token      String   @db.VarChar
  expires_at DateTime @db.Timestamp
  user       User     @relation(fields: [user_id], references: [id])
}

model Transaction {
  id               String          @id @default(uuid())
  user_id          String
  category_id      Int
  wallet_id        String
  amount           Decimal         @db.Decimal
  type             TransactionType // Menggunakan Enum
  note             String?         @db.Text
  transaction_date DateTime        @db.Timestamp

  wallet      Wallet       @relation(fields: [wallet_id], references: [id])
  category    Category     @relation(fields: [category_id], references: [id])
  attachments Attachment[]

  @@index([user_id])
  @@index([transaction_date])
}

model User {
  id         String   @id @default(uuid())
  full_name  String   @db.VarChar
  email      String   @unique @db.VarChar
  password   String   @db.VarChar
  role       UserRole @default(USER) // Menggunakan Enum
  created_at DateTime @default(now()) @db.Timestamp

  wallets        Wallet[]
  budgets        Budget[]
  notifications  Notification[]
  otps           Otp[]
  refresh_tokens RefreshToken[]
  activity_logs  ActivityLog[]
}

model Wallet {
  id         String    @id @default(uuid()) // UUID untuk keamanan ID Wallet
  user_id    String // String karena User menggunakan UUID
  name       String    @db.VarChar
  balance    Decimal   @default(0) @db.Decimal(12, 2) // Detail: 12 digit, 2 desimal
  type       String
  created_at DateTime  @default(now()) @db.Timestamp
  deleted_at DateTime?

  // Relasi
  user         User          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  transactions Transaction[]
}

// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated"
}

datasource db {
  provider = "postgresql"
}

// Definisi Enum diletakkan di sini
enum TransactionType {
  INCOME
  EXPENSE
}

enum OtpType {
  REGISTRATION
  PASSWORD_RESET
}

enum UserRole {
  USER
  ADMIN
}
